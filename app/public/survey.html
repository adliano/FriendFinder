<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Friends Finder</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Pushy Button Minified Version -->
    <!-- <link rel="stylesheet" href="../../assets/css/pushy-buttons.min.css" /> -->

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link
      href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
  </head>
  <!-- ---------------------------- -->
  <!-- ------------ BODY ---------- -->
  <!-- ---------------------------- -->
  <body class="bg-light">
    <!-- ---- Container ---- -->
    <div class="container bg-secondary  mt-3 py-3">
      <!-- -- Jumbotron -- -->
      <div class="jumbotron">
        <h1 class="display-3 text-center">Survey Questions</h1>
        <p class="lead text-center">
          Answer the question to help us find you a friend
        </p>
        <hr class="my-2" />
      </div>
      <!-- :: end of Jumbotron :: -->

      <!-- ---- Card About you ---- -->
      <div class="card">
        <!-- Card Header -->
        <div class="card-header">
          <h2 class="card-title">About You</h2>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <!-- ---- Form ---- -->
          <div class="form-group">
            <!-- Get user name -->
            <label for="name"
              ><i class="material-icons mr-2">perm_identity</i> Name</label
            >
            <input
              type="text"
              class="form-control"
              name="usrName"
              id="usrName"
              aria-describedby="helpId"
            />
            <label for="image"
              ><i class="material-icons mt-2 mr-2">add_a_photo</i> Link to Photo
              Image (Required)</label
            >
            <input
              type="text"
              class="form-control"
              name="usrPicture"
              id="usrPicture"
              aria-describedby="helpId"
            />
            <!-- <small id="helpId" class="form-text text-muted">Help text</small> -->
          </div>
        </div>
      </div>
      <!-- :: End of Card :: -->

      <!-- ---- Card Questions ---- -->
      <div class="card mt-4">
        <!-- Card Header -->
        <div class="card-header">
          <h2 class="card-title">Questions</h2>
        </div>
        <div id="surveyQUestions" class="card-body">
          <div class="form-group">
            <!-- ----------------------------------------- -->
            <!-- Script used to load selectors dynamically -->
            <!-- ----------------------------------------- -->
            <script>
              let questions = [
                "Your mind is always buzzing with unexplored ideas and plans.",
                "Generally speaking, you rely more on your experience than your imagination.",
                "You find it easy to stay relaxed and focused even when there is some pressure.",
                "You rarely do something just out of sheer curiosity.",
                "People can rarely upset you.",
                "It is often difficult for you to relate to other people’s feelings.",
                "In a discussion, truth should be more important than people’s sensitivities.",
                "You rarely get carried away by fantasies and ideas.",
                "You think that everyone’s views should be respected regardless of whether they are supported by facts or not.",
                "You feel more energetic after spending time with a group of people."
              ];

              let container = document.querySelector("#surveyQUestions");

              for (let i = 0; i < questions.length; i++) {
                let _question = `<div class="my-4">
                <h4>Question ${i + 1}</h4>
                <label for="question${i + 1}">${questions[i]}</label>
                <select 
                class="form-control" 
                name="question${i + 1}" 
                id="question${i + 1}">
                  <option value="" selected="selected" hidden="hidden">Select an Option</option>
                  <option value="1">1 (Strongly Disagree)</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5 (Strongly Agree)</option>
                </select>
                </div>`;

                container.insertAdjacentHTML("beforeend", _question);
              }
            </script>
          </div>
          <!-- :: end form :: -->
        </div>
        <!-- :: end card-body :: -->
      </div>
      <!-- :: end card :: -->

      <!-- --- Submit Button --- -->
      <div class="text-center my-5">
        <button id="submitButton" class="mdc-button mdc-button--raised w-75">
          <h3><i class="material-icons">done_outline</i> Submit</h3>
        </button>
      </div>
    </div>
    <!-- :: end container -->

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
<!-- ******************************************************* -->
<!-- *** Script to get data from user and send to Server *** -->
<!-- ******************************************************* -->
<script type="text/javascript">
  // Function to use on Event listener (callback)
  function onButoonClick(event) {
    // Array to hold scores
    let _scores = [];
    // Get all <select> and place into an Array
    let _selectors = document.querySelectorAll("select");
    // Loop through Array of <select>
    for (let _select of _selectors) {
      // Get data from each <select> and push to _scores array
      _scores.push(_select.value.trim());
    }
    // Save all user data into a JSON
    let _userData = {
      name: document.querySelector("#usrName").value.trim(),
      picture: document.querySelector("#usrPicture").value.trim(),
      score: _scores
    };
    ////// DEBUGING \\\\\\
    //console.log(_userData);
    // Fetch to post data into server
    fetch("/api/survey", {
      method: "POST",
      body: JSON.stringify(_userData),
      headers: {
        "Content-Type": "application/json"
      }
    })
      .then(res => res.json())
      .then(data => {
        alert("DATA SENT");
        console.log(data);
      });
  }
  // Add event listener to submit button
  document
    .querySelector("#submitButton")
    .addEventListener("click", onButoonClick);
</script>
